---
# Playbook to update a galaxy distribution

- hosts: 
  - workers
  user: admin
  sudo: True
  tasks:
  - name: Shutdown SLURM in workers
    service: name=slurm-llnl state=stopped

- hosts: 
  - master
  user: admin
  sudo: True
  tasks:
  - name: Shutdown SLURM and galaxy on master
    service: name={{ item }} state=stopped
    with_items:
    - galaxy
    - slurm-llnl

- hosts: 
  - fileserver
  user: admin
  sudo: True
  tasks:
  - name: Dummy task to get fileserver info
    debug: msg="Connected to fileserver"

- hosts: master
  user: admin
  sudo: True
  vars_files: 
  - roles/core/vars/main.yml
  - credentials/user_data.yml
  roles:
  - core
  - galaxy

- hosts: workers
  user: admin
  sudo: True
  tasks:
  - name: Start slurm
    service: name={{ item }} state=started
    with_items:
    - slurm-llnl

- hosts: master
  user: admin
  sudo: True
  vars_files:
  - credentials/user_data.yml
  tasks:
  - name: Start galaxy and SLURM
    service: name={{ item }} state=started
    with_items:
    - slurm-llnl
    - galaxy
